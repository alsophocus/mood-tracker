# PostgreSQL Setup Guide for Railway

## Overview
This mood tracker application uses PostgreSQL with psycopg3 for Python 3.14 compatibility.

## Railway PostgreSQL Setup

### 1. Create PostgreSQL Service
1. Go to your Railway project dashboard
2. Click "New Service" → "Database" → "Add PostgreSQL"
3. Railway will provision the database automatically

### 2. Get Connection Details
From your PostgreSQL service → Variables tab, you'll get:
- `DATABASE_URL` (internal connection string)
- `DATABASE_PUBLIC_URL` (public connection - avoid for security)

### 3. Environment Variables
Set in your web service → Variables tab:
```
DATABASE_URL=postgresql://postgres:PASSWORD@postgres-XXXX.railway.internal:5432/railway
```

## Technical Details

### Library Used
- **psycopg[binary]==3.2.10** (Python 3.14 compatible)
- Replaces psycopg2-binary which has compatibility issues

### Connection Method
- **Internal Railway network**: `postgres-XXXX.railway.internal:5432`
- **Secure**: Only accessible within Railway services
- **No public access**: Prevents external connections

### Database Schema
```sql
-- Users table
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email TEXT UNIQUE,
    name TEXT,
    provider TEXT
);

-- Moods table  
CREATE TABLE moods (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    date DATE,
    mood TEXT,
    notes TEXT,
    UNIQUE(user_id, date)
);
```

## Troubleshooting

### Common Issues
1. **"Servname not supported"**: Wrong hostname in DATABASE_URL
2. **"Application Failed to Respond"**: Database initialization blocking startup
3. **"Maximum recursion depth"**: Circular dependency in database initialization

### Debug Endpoints
- `/status` - Basic app health
- `/test-db` - PostgreSQL connection test
- `/debug-oauth` - Database + OAuth status
- `/health` - Full system health check

### Rollback Point
If issues occur, rollback to tag: `v1.0-stable`
```bash
git checkout v1.0-stable
```

## Security Notes
- Uses internal Railway network (secure)
- No public database access
- OAuth credentials stored as environment variables
- Database credentials auto-generated by Railway
