<!DOCTYPE html>
<html>
<head>
    <title>Mood Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial; max-width: 900px; margin: 50px auto; padding: 20px; }
        .mood-buttons { display: flex; gap: 10px; margin: 20px 0; }
        .mood-btn { padding: 15px 20px; border: none; border-radius: 5px; cursor: pointer; }
        .super-sad { background: #ff4444; color: white; }
        .sad { background: #ff8844; color: white; }
        .neutral { background: #ffdd44; }
        .good { background: #88ff44; }
        .super-good { background: #44ff44; }
        .export-btn { background: #4444ff; color: white; padding: 10px 20px; border: none; border-radius: 5px; }
        .notes-field { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        .analytics { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin: 30px 0; }
        .analytics-card { background: #f5f5f5; padding: 20px; border-radius: 10px; text-align: center; }
        .analytics-number { font-size: 2em; font-weight: bold; color: #4444ff; }
        .chart-container { margin: 30px 0; height: 400px; position: relative; }
        .chart-container canvas { max-height: 350px; }
        .weekly-patterns { margin: 30px 0; clear: both; }
        .day-pattern { display: inline-block; margin: 5px; padding: 10px; background: #f0f0f0; border-radius: 5px; }
        .history { margin-top: 50px; clear: both; }
        .entry { padding: 10px 0; border-bottom: 1px solid #eee; }
        .entry-notes { font-style: italic; color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <h1>Daily Mood Tracker</h1>
    
    <form method="POST" action="/save_mood">
        <p>How are you feeling today?</p>
        <div class="mood-buttons">
            <button type="submit" name="mood" value="super sad" class="mood-btn super-sad">üò¢ Super Sad</button>
            <button type="submit" name="mood" value="sad" class="mood-btn sad">üòû Sad</button>
            <button type="submit" name="mood" value="neutral" class="mood-btn neutral">üòê Neutral</button>
            <button type="submit" name="mood" value="good" class="mood-btn good">üòä Good</button>
            <button type="submit" name="mood" value="super good" class="mood-btn super-good">üòÑ Super Good</button>
        </div>
        <textarea name="notes" placeholder="Optional: Add notes about your day..." class="notes-field" rows="3"></textarea>
    </form>
    
    <a href="/export_pdf"><button class="export-btn">üìÑ Export PDF</button></a>
    
    <div class="analytics">
        <div class="analytics-card">
            <div class="analytics-number">{{ analytics.current_streak }}</div>
            <div>Current Good Streak</div>
        </div>
        <div class="analytics-card">
            <div class="analytics-number">{{ analytics.best_streak }}</div>
            <div>Best Streak Ever</div>
        </div>
        <div class="analytics-card">
            <div class="analytics-number">{{ moods|length }}</div>
            <div>Total Days Tracked</div>
        </div>
    </div>
    
    <div class="weekly-patterns">
        <h3>Weekly Patterns</h3>
        {% for day in ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'] %}
            {% if analytics.weekly_patterns[day] %}
            <div class="day-pattern">
                <strong>{{ day }}</strong><br>
                Avg: {{ analytics.weekly_patterns[day] }}/5
            </div>
            {% endif %}
        {% endfor %}
    </div>
    
    <div class="chart-container">
        <h3>Monthly Mood Trends</h3>
        <canvas id="moodChart"></canvas>
    </div>
    
    <div class="history">
        <h3>Mood History</h3>
        {% for date, mood, notes in moods %}
        <div class="entry">
            <strong>{{ date }}</strong>: {{ mood }}
            {% if notes %}
            <div class="entry-notes">{{ notes }}</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <script>
        fetch('/mood_data')
            .then(response => response.json())
            .then(data => {
                const ctx = document.getElementById('moodChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.month),
                        datasets: [{
                            label: 'Average Mood',
                            data: data.map(d => d.mood),
                            borderColor: '#4444ff',
                            backgroundColor: 'rgba(68, 68, 255, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                min: 1,
                                max: 5,
                                ticks: {
                                    callback: function(value) {
                                        const labels = ['', 'Super Sad', 'Sad', 'Neutral', 'Good', 'Super Good'];
                                        return labels[value];
                                    }
                                }
                            }
                        }
                    }
                });
            });
    </script>
</body>
</html>
